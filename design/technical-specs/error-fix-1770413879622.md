# Technical Specification: Core UI, Google Login & Basic Dashboard

## Architecture Overview
This feature establishes a foundational web application architecture consisting of a modern React frontend and a dedicated backend service for secure Google authentication and basic data serving. The frontend, built with a React framework (e.g., Next.js or Vite) and Shadcn UI, will be hosted on a Content Delivery Network (CDN) for performance and scalability. User authentication will utilize Google OAuth 2.0 with the Proof Key for Code Exchange (PKCE) flow, ensuring robust security through backend token verification. A minimal backend API will handle authentication callbacks, session management, and serve mock dashboard content.

## Components

### 1. Frontend Application
- **Technology**: React (e.g., Next.js or Vite), TypeScript, Shadcn UI, Tailwind CSS.
- **Purpose**: Provides the user interface, handles user interactions, initiates authentication flow, and displays dashboard content.
- **Key Modules/Pages**:
    - **Login Page**: Displays the 'Sign in with Google' button. Orchestrates the redirection to Google for OAuth and handles the callback from Google.
    - **Dashboard Page**: The primary landing page post-login, displaying mock content. Includes navigation and basic layout using Shadcn UI components.
    - **Auth Client**: Manages the client-side aspects of Google OAuth (e.g., generating PKCE code verifier/challenge, initiating redirect).
    - **API Client**: Handles secure communication with the backend authentication and data services, including managing session tokens.
    - **UI Library**: Shadcn UI for all visual components, ensuring consistency and accessibility.

### 2. Backend Authentication Service
- **Technology**: Node.js (e.g., Express), Python (e.g., Flask/FastAPI), or Go, deployed as serverless functions or a microservice.
- **Purpose**: Securely handles Google OAuth token exchange, verifies user identity, and establishes/manages user sessions.
- **Key Endpoints/Functions**:
    - **`/api/auth/google/callback`**: Receives the authorization code from the frontend, exchanges it with Google for ID and access tokens, verifies the ID token's authenticity, creates or retrieves a user record, and establishes a secure session (e.g., issues a signed JWT or sets an HttpOnly/Secure cookie).
    - **User Management (minimal)**: Stores essential user information (e.g., Google ID, email, name) upon first login.

### 3. Backend Data Service (for mock content)
- **Technology**: Integrated into the Backend Authentication Service or as a separate minimal service.
- **Purpose**: Serves the initial mock content for the dashboard.
- **Key Endpoints/Functions**:
    - **`/api/dashboard/data` (authenticated)**: Returns mock data for the dashboard. Requires a valid user session.

## Data Models

### User (Minimal for Authentication)
```json
{
  "id": "string",          // Unique internal user ID
  "googleId": "string",      // Google's unique ID for the user
  "email": "string",       // User's email address from Google (verified)
  "name": "string",        // User's display name from Google
  "profilePicture": "string",// URL to user's profile picture
  "createdAt": "datetime",
  "updatedAt": "datetime"
}
```

### Session (Backend Internal)
```json
{
  "sessionId": "string",   // Unique ID for the session
  "userId": "string",      // Foreign key to the User model
  "expiresAt": "datetime", // Session expiration timestamp
  "createdAt": "datetime"
}
```

## APIs

### 1. Google OAuth Flow (High-Level)
- **Step 1 (Frontend)**: User clicks 'Sign in with Google'. Frontend constructs Google OAuth URL with PKCE challenge and redirects user.
- **Step 2 (Google)**: User authenticates with Google and grants consent.
- **Step 3 (Google -> Frontend)**: Google redirects user back to the application's callback URL (e.g., `/auth/google/callback`) with an authorization `code` and `state` parameter.
- **Step 4 (Frontend -> Backend)**: Frontend extracts the `code` and sends it to the backend for verification.

### 2. Backend Authentication API
#### Endpoint: `POST /api/auth/google/callback`
- **Purpose**: Exchange Google authorization code for tokens, verify identity, and establish a user session.
- **Authentication**: None (first step of session establishment).
- **Request Body**:
```json
{
  "code": "string",          // The authorization code received from Google
  "code_verifier": "string", // The PKCE code verifier generated by the client
  "redirect_uri": "string"   // The redirect URI used in the initial OAuth request
}
```
- **Response (Success - 200 OK)**:
    - Sets a secure, HttpOnly, SameSite=Lax/Strict cookie containing a session ID or JWT.
    - Body: `{ "message": "Authentication successful", "user": { "id": "string", "email": "string" } }`
- **Response (Error - 400 Bad Request / 500 Internal Server Error)**:
```json
{
  "error": "string",
  "details": "string" // Optional: more specific error details
}
```

### 3. Backend Data API
#### Endpoint: `GET /api/dashboard/data`
- **Purpose**: Fetch mock content for the user's dashboard.
- **Authentication**: Requires a valid session token (e.g., from the session cookie).
- **Request Headers**: `Cookie: session_id=<session_id>` or `Authorization: Bearer <jwt_token>`
- **Response (Success - 200 OK)**:
```json
{
  "title": "string",
  "content": "string",
  "lastUpdated": "datetime"
}
```
- **Response (Error - 401 Unauthorized / 500 Internal Server Error)**:
```json
{
  "error": "string"
}
```

## Infrastructure
- **Frontend Hosting**: Content Delivery Network (CDN) such as Vercel, Netlify, AWS S3/CloudFront, or Google Cloud Storage/CDN. This provides high availability, low latency, and scalability for the static React application.
- **Backend Services**: Serverless functions (e.g., AWS Lambda, Google Cloud Functions, Azure Functions) or a containerized microservice deployed on a managed platform (e.g., AWS Fargate, Google Cloud Run). This offers auto-scaling, cost-efficiency, and reduced operational overhead.
- **Database**: A managed relational database (e.g., PostgreSQL via AWS RDS, Google Cloud SQL) for storing user profiles and session data. This ensures data consistency, reliability, and ease of scaling.
- **DNS**: Standard DNS management for domain routing.
- **SSL/TLS**: Mandatory HTTPS for all communication between client, backend, and Google OAuth endpoints. Managed by CDN, Load Balancer, or API Gateway.
- **Secrets Management**: Secure storage for API keys (e.g., Google OAuth client secret) using cloud-native secret managers (AWS Secrets Manager, Google Secret Manager, Azure Key Vault).

## Testing Strategy
- **Unit Tests**: 
    - **Frontend**: Jest/React Testing Library for individual React components (e.g., LoginButton, DashboardLayout) and client-side auth utility functions.
    - **Backend**: Jest/Vitest/Pytest for API handlers, token verification logic, and user/session management functions.
- **Integration Tests**: 
    - **Auth Flow**: Test the end-to-end Google OAuth flow by mocking Google's responses and verifying backend token exchange and session creation.
    - **API Interactions**: Verify correct communication between the frontend API client and backend services.
- **End-to-End (E2E) Tests**: 
    - **User Journey**: Cypress or Playwright to simulate a full user journey: navigating to login, clicking 'Sign in with Google' (mocking Google redirect), verifying dashboard access, and checking UI consistency.
    - **Error Handling**: Test various error scenarios (e.g., failed Google auth, backend session creation failure).
- **Security Testing**: 
    - **Vulnerability Scanning**: Use automated tools to scan for common web vulnerabilities.
    - **Penetration Testing**: Manual and automated tests specifically targeting OAuth 2.0 implementation, session management, and data handling.
    - **Authentication Hardening**: Verify correct use of HttpOnly/Secure cookies, CSRF protection, and token validation.

## Deployment
- **CI/CD Pipeline**: Automated CI/CD pipelines for both frontend and backend services.
    - **Frontend**: Triggers on code merge to `main` branch, builds the React application, runs tests, and deploys to the CDN.
    - **Backend**: Triggers on code merge to `main` branch, builds the service, runs tests, and deploys to the serverless platform or container service.
- **Rollout Strategy**: 
    - **Frontend**: Atomic deployments facilitated by CDN, ensuring instant updates with rollback capabilities.
    - **Backend**: For serverless, deployments are atomic. For containerized services, implement Blue/Green or Canary deployments to minimize downtime and risk.
- **Feature Flags**: Not strictly necessary for this foundational feature, but a framework for feature flags should be considered for future feature rollouts.
- **Monitoring and Alerts**: 
    - **Frontend**: Implement error tracking (e.g., Sentry, LogRocket) for client-side errors and performance monitoring (e.g., Lighthouse CI, Web Vitals).
    - **Backend**: Monitor API request rates, error rates, latency, and specific authentication success/failure metrics. Set up alerts for critical errors, security events, and performance degradation. Use structured logging for auditability and debugging.
